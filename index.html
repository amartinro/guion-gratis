<!doctype html>
<html lang="es" class="h-full">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guión gratis para tu próximo Reel — por Alberto Martín</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="Genera un guion corto GPS (gancho-problema-solución) para tu negocio en 30s. 100% gratis.">
  <style>
    /* Fondo con gradiente sutil */
    .bg-grid {
      background: radial-gradient(1200px 600px at 10% -10%, rgba(79,70,229,0.25), transparent 60%),
                  radial-gradient(800px 400px at 100% 0%, rgba(16,185,129,0.18), transparent 55%),
                  radial-gradient(600px 600px at 30% 100%, rgba(99,102,241,0.12), transparent 60%);
    }
  </style>
</head>
<body class="h-full bg-neutral-950 text-neutral-100 bg-grid">
  <header class="max-w-3xl mx-auto px-4 pt-10 pb-6">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl md:text-4xl font-semibold tracking-tight">
          Guión corto para tu próximo Reel — <span class="text-indigo-400 font-bold">GRATIS</span>
        </h1>
        <p class="mt-2 text-neutral-400">Estructura GPS (gancho–problema–solución) en 8–12s. Ideal para negocios locales.</p>
      </div>
      <a href="https://www.instagram.com/amartinro/" target="_blank" rel="noopener" class="group inline-flex items-center gap-2 text-sm text-neutral-300 hover:text-white">
        <!-- Simple Instagram-like icon -->
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" class="opacity-80 group-hover:opacity-100">
          <rect x="3" y="3" width="18" height="18" rx="5" stroke="currentColor" stroke-width="1.5"/>
          <circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="1.5"/>
          <circle cx="17.5" cy="6.5" r="1.2" fill="currentColor"/>
        </svg>
        <span class="font-medium">Alberto Martín</span>
      </a>
    </div>
    <!-- <div class="mt-3">
      <a href="https://www.instagram.com/amartinro/" target="_blank" rel="noopener" class="text-xs text-indigo-300 hover:text-indigo-200 underline">@amartinro</a>
    </div> -->
  </header>

  <main class="max-w-3xl mx-auto px-4 pb-16">
    <section class="rounded-2xl border border-neutral-800 bg-neutral-900/70 shadow-xl backdrop-blur p-6 md:p-8">
      <form id="guion-form" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm text-neutral-300">Nombre*</label>
            <input name="nombre" required class="mt-1 w-full rounded-xl border border-neutral-700 bg-neutral-800 text-neutral-100 placeholder-neutral-500 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
          </div>
          <div>
            <label class="block text-sm text-neutral-300">Teléfono (contacto)</label>
            <input name="telefono" placeholder="+34 6XX XXX XXX" class="mt-1 w-full rounded-xl border border-neutral-700 bg-neutral-800 text-neutral-100 placeholder-neutral-500 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm text-neutral-300">Email*</label>
            <input name="email" required class="mt-1 w-full rounded-xl border border-neutral-700 bg-neutral-800 text-neutral-100 placeholder-neutral-500 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
          </div>
          <!-- <div>
            <label class="block text-sm text-neutral-300">Teléfono (contacto)</label>
            <input name="telefono" placeholder="+34 6XX XXX XXX" class="mt-1 w-full rounded-xl border border-neutral-700 bg-neutral-800 text-neutral-100 placeholder-neutral-500 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
          </div> -->
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm text-neutral-300">Instagram (@sin @)*</label>
            <input name="instagram" required placeholder="nombredeusuario" class="mt-1 w-full rounded-xl border border-neutral-700 bg-neutral-800 text-neutral-100 placeholder-neutral-500 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
          </div>
          <div>
            <label class="block text-sm text-neutral-300">Ciudad</label>
            <input name="ciudad" placeholder="Salamanca" class="mt-1 w-full rounded-xl border border-neutral-700 bg-neutral-800 text-neutral-100 placeholder-neutral-500 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
          </div>
        </div>

        <div>
          <label class="block text-sm text-neutral-300">Sector/negocio (1 frase)*</label>
          <input name="sector" required placeholder="Pizzería artesana, horno de leña" class="mt-1 w-full rounded-xl border border-neutral-700 bg-neutral-800 text-neutral-100 placeholder-neutral-500 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
        </div>

        <div>
          <label class="block text-sm text-neutral-300">¿Qué buscas obtener? <span class="text-neutral-400">(autoridad, alcance, ventas; e indica 3 frenos habituales: falta de tiempo, pocas ideas, baja retención)</span>*</label>
          <textarea name="objetivo" required rows="3" placeholder="Ej.: autoridad en mi zona, más alcance orgánico, ventas del menú del día; frenos: falta de tiempo, pocas ideas, baja retención" class="mt-1 w-full rounded-xl border border-neutral-700 bg-neutral-800 text-neutral-100 placeholder-neutral-500 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"></textarea>
        </div>

        <div>
          <label class="block text-sm text-neutral-300">¿En qué destaca tu negocio sobre la competencia?*</label>
          <textarea name="diferencial" required rows="3" placeholder="Ej.: horno de leña, producto local, reseñas 4,8★, rapidez en entrega, ubicación céntrica, parking propio..." class="mt-1 w-full rounded-xl border border-neutral-700 bg-neutral-800 text-neutral-100 placeholder-neutral-500 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"></textarea>
        </div>

        <div>
          <label class="block text-sm text-neutral-300">Competidor (URL de Instagram, opcional)</label>
          <input name="competidor" placeholder="https://instagram.com/competidor" class="mt-1 w-full rounded-xl border border-neutral-700 bg-neutral-800 text-neutral-100 placeholder-neutral-500 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
        </div>

        <!-- Cloudflare Turnstile (dark) -->
        <div class="mt-2">
          <div class="cf-turnstile" data-sitekey="0x4AAAAAAB319LvRRrr4YA6R" data-theme="dark" data-callback="onTS"></div>
        </div>

        <details class="text-xs text-neutral-400 mt-2">
          <summary class="cursor-pointer underline underline-offset-2 decoration-neutral-600 hover:decoration-indigo-500">Política de protección de datos (UE) — resumen</summary>
          <div class="mt-2 space-y-2">
            <p><strong>Responsable:</strong> Alberto Martín · Contacto: a.martinro@gmail.com.</p>
            <p><strong>Finalidad:</strong> generar el guion solicitado, mantener contacto comercial y gestionar citas.</p>
            <p><strong>Legitimación:</strong> tu consentimiento al marcar la casilla y, en su caso, interés legítimo para comunicaciones relacionadas con tu solicitud.</p>
            <p><strong>Destinatarios/Encargados:</strong> Cloudflare (hosting y seguridad), Google (Google Sheets, si lo configuras). No se prevén transferencias fuera de la UE sin garantías adecuadas.</p>
            <p><strong>Conservación:</strong> hasta 12 meses o hasta que solicites su supresión.</p>
            <p><strong>Derechos:</strong> acceso, rectificación, supresión, oposición, limitación y portabilidad. Puedes ejercerlos en a.martinro@gmail.com.</p>
            <p><strong>Información adicional:</strong> consulta la Política de Privacidad completa en <a href="#" target="_blank" class="underline">este enlace</a>.</p>
            <p class="italic">*Plantilla orientativa: ajusta con tu asesoría.</p>
          </div>
        </details>

        <label class="flex items-center gap-2 text-sm mt-2">
          <input type="checkbox" name="consent" required class="h-4 w-4 accent-indigo-600">
          <span>He leído y acepto la <a href="#" target="_blank" class="underline">Política de Privacidad</a>.</span>
        </label>

        <button type="submit" class="mt-3 w-full md:w-auto rounded-xl bg-indigo-600 text-white px-5 py-2.5 font-semibold hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-400">Generar guion</button>
        <p id="msg" class="text-sm text-neutral-400 inline-block ml-3"></p>
      </form>
    </section>

    <section id="resultado" class="hidden mt-8 rounded-2xl border border-neutral-800 bg-neutral-900/70 shadow-xl backdrop-blur p-6 md:p-8">
      <h2 class="text-2xl font-semibold">Tu guion GPS</h2>
      <div id="guion" class="mt-3 space-y-1 text-neutral-200"></div>

      <h3 class="text-xl font-semibold mt-6">Plano a plano</h3>
      <div id="plano" class="mt-2 space-y-2 text-neutral-200"></div>

      <h3 class="text-xl font-semibold mt-6">3 variantes de gancho</h3>
      <ul id="variantes" class="list-disc pl-5 mt-2 space-y-1 text-neutral-200"></ul>

      <h3 class="text-xl font-semibold mt-6">Checklist DIY</h3>
      <ul id="checklist" class="list-disc pl-5 mt-2 space-y-1 text-neutral-200"></ul>

      <div class="mt-6 flex flex-wrap gap-3">
        <button id="copiar" class="rounded-xl border border-neutral-700 bg-neutral-800 px-4 py-2 hover:bg-neutral-700">Copiar guion</button>
        <a id="whatsapp" target="_blank" rel="noopener" class="rounded-xl px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white font-semibold">Grábalo conmigo (WhatsApp)</a>
        <a href="https://cueprompter.com/" target="_blank" rel="noopener" class="rounded-xl border border-neutral-700 bg-neutral-800 px-4 py-2 hover:bg-neutral-700">Abrir teleprompter</a>
      </div>
    </section>
  </main>

  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
  <script>
  const API_URL = "https://hook.eu1.make.com/yjamhggycrrranolpeb5fec5d3ibkxmk"; // <- Cambia esto
  const WA_NUM = "34665651344"; // <- Tu WhatsApp

  // Turnstile callback: guarda el token más reciente por si el input oculto aún no está presente
  window.onTS = function(token){ window.__tsToken = token; };

  const form = document.getElementById('guion-form');
  const msg  = document.getElementById('msg');
  const out  = document.getElementById('resultado');

  // Captura UTMs si existen
  const params = new URLSearchParams(location.search);
  const UTM = {
    utm_source: params.get('utm_source') || '',
    utm_medium: params.get('utm_medium') || '',
    utm_campaign: params.get('utm_campaign') || '',
    utm_content: params.get('utm_content') || '',
    utm_term: params.get('utm_term') || ''
  };

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    msg.textContent = 'Generando...';
    const fd = new FormData(form);
    const tsToken = document.querySelector('input[name="cf-turnstile-response"]')?.value || '';

    const payload = {
      nombre: fd.get('nombre'),
      email: fd.get('email'),
      instagram: (fd.get('instagram')||'').replace(/^@/, ''),
      telefono: fd.get('telefono') || '',
      ciudad: fd.get('ciudad') || '',
      sector: fd.get('sector'),
      objetivo: fd.get('objetivo') || '',
      diferencial: fd.get('diferencial') || '',
      competidor: fd.get('competidor') || '',
      consent: !!fd.get('consent'),
      turnstileToken: tsToken || window.__tsToken || '',
      ...UTM
    };

    try{
      const res = await fetch(API_URL, {
        method: 'POST',
        mode: 'cors',
        cache: 'no-store',
        headers: { 'Content-Type': 'text/plain', 'Accept': 'application/json' },
        body: JSON.stringify(payload)
      });
      //const data = await res.json();
      const raw = await res.text();
      let data;
      try { data = raw ? JSON.parse(raw) : null; }
      catch { throw new Error('Respuesta no válida del servidor: ' + (raw ? raw.slice(0,180) : '(vacío)')); }
      if (!res.ok || !data || data.error) {
        const serverMsg = (data && data.error) ? data.error : (raw ? raw.slice(0,180) : 'Error en servidor');
        throw new Error(serverMsg);
      }
      

      const g = data.guion;
      document.getElementById('guion').innerHTML = `
        <p><span class="text-neutral-400">Gancho:</span> ${g.gancho}</p>
        <p><span class="text-neutral-400">Problema:</span> ${g.problema}</p>
        <p><span class="text-neutral-400">Solución:</span> ${g.solucion}</p>
        <p><span class="text-neutral-400">CTA:</span> ${g.cta}</p>
      `;
      document.getElementById('plano').innerHTML = (data.plano_a_plano||[]).map(p =>
        `<p><strong>${p.segundos}:</strong> ${p.accion} · <em class="text-neutral-300">${p.texto_pantalla}</em> · Voz: ${p.voz}</p>`
      ).join('');
      document.getElementById('variantes').innerHTML = (data.variantes_gancho||[]).map(v=>`<li>${v}</li>`).join('');
      document.getElementById('checklist').innerHTML = (data.checklist_diy||[]).map(v=>`<li>${v}</li>`).join('');

      const fullText = `GANCHO: ${g.gancho}\nPROBLEMA: ${g.problema}\nSOLUCIÓN: ${g.solucion}\nCTA: ${g.cta}\n\nPLANO A PLANO:\n` +
        (data.plano_a_plano||[]).map(p=>`${p.segundos}: ${p.accion} | ${p.texto_pantalla} | Voz: ${p.voz}`).join('\n');

      document.getElementById('copiar').onclick = async ()=>{
        await navigator.clipboard.writeText(fullText);
        msg.textContent = 'Copiado ✅';
      };
      const wa = document.getElementById('whatsapp');
      wa.href = `https://wa.me/${WA_NUM}?text=${encodeURIComponent('Quiero grabar este guion:\n\n' + fullText)}`;

      out.classList.remove('hidden');
      msg.textContent = '¡Listo!';
      out.scrollIntoView({ behavior: 'smooth' });
    }catch(err){
      msg.textContent = 'Error: ' + err.message;
    }
  });
  </script>
</body>
</html>
